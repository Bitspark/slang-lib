# Median: calculates median value
---
services:
  main:
    in:
      type: stream
      stream:
        type: number
    out:
      type: number

properties:
  emptyValue:
    type: generic
    generic: emptyType

operators:
  # Sort the stream
  sorter:
    operator: slang.stream.mergeSort
  # Get length of stream
  length:
    operator: slang.stream.length
    generics:
      itemType:
        type: number
  # Calculate middle index
  halve:
    operator: slang.eval
    properties:
      expression: floor(x/2)
      variables: ["x"]
  # Take middle value from sorted stream
  takenth:
    operator: slang.stream.takeNth
    generics:
      itemType:
        type: number
    properties:
      default: $emptyValue

connections:
  (:
  - (sorter
  - (length
  length):
  - x(halve
  sorter):
  - items(takenth
  halve):
  - index(takenth
  takenth)item:
  - )
