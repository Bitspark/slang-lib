services:
  main:
    in:
      type: stream
      stream:
        type: number
    out:
      type: number
operators:
  div:
    operator: slang.eval
    properties:
      expression: sum/length
      variables:
      - sum
      - length
  gtzero:
    operator: slang.eval
    properties:
      expression: length == 0
      variables:
      - length
  length:
    operator: slang.stream.length
    generics:
      itemType:
        type: number
  sum:
    operator: .sum
  switch:
    operator: slang.syncMerge
    generics:
      itemType:
        type: primitive
  zeroval:
    operator: slang.const
    properties:
      value: $zeroValue
    generics:
      valueType:
        type: generic
        generic: zeroType
properties:
  zeroValue:
    type: generic
    generic: zeroType
connections:
  (:
  - (sum
  - (length
  div):
  - false(switch
  gtzero):
  - select(switch
  length):
  - length(div
  - (zeroval
  - length(gtzero
  sum):
  - sum(div
  switch):
  - )
  zeroval):
  - true(switch
