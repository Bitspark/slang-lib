# Average: calculates average value
---
services:
  main:
    in:
      type: stream
      stream:
        type: number
    out:
      type: number

properties:
  zeroValue:
    type: generic
    generic: valueType

operators:
  sum:
    operator: .sum
  length:
    operator: slang.stream.length
    generics:
      itemType:
        type: number
  div:
    operator: slang.eval
    properties:
      expression: sum/length
      variables: ["sum", "length"]
  zeroval:
    operator: slang.const
    generics:
      valueType:
        type: primitive
    properties:
      value: $zeroValue
  gtzero:
    operator: slang.eval
    properties:
      expression: length > 0
      variables: ["length"]
  switch:
    operator: slang.syncMerge
    generics:
      itemType:
        type: primitive

connections:
  (:
  - (sum
  - (length
  sum):
  - sum(div
  length):
  - length(div
  - (zeroval
  - length(gtzero
  gtzero):
  - select(switch
  zeroval):
  - false(switch
  div):
  - true(switch
  switch):
  - )
