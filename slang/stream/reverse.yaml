services:
  main:
    in:
      type: stream
      stream:
        type: generic
        generic: itemType
    out:
      type: stream
      stream:
        type: generic
        generic: itemType
operators:
  const:
    operator: slang.const
    properties:
      value: []
    generics:
      valueType:
        type: stream
        stream:
          type: generic
          generic: itemType
  eval:
    operator: slang.eval
    properties:
      expression: x-1
      variables:
      - x
  eval1:
    operator: slang.eval
    properties:
      expression: x-1
      variables:
      - x
  eval2:
    operator: slang.eval
    properties:
      expression: x >= 0
      variables:
      - x
  eval3:
    operator: slang.eval
    properties:
      expression: x>0
      variables:
      - x
  length:
    operator: slang.stream.length
    generics:
      itemType:
        type: generic
        generic: itemType
  loop:
    operator: slang.loop
    generics:
      stateType:
        type: map
        map:
          index:
            type: number
  repeat:
    operator: slang.stream.repeat
    generics:
      itemType:
        type: stream
        stream:
          type: generic
          generic: itemType
  switch:
    operator: slang.switch
    properties:
      cases:
      - true
      - false
    generics:
      inType:
        type: map
        map:
          items:
            type: stream
            stream:
              type: generic
              generic: itemType
          length:
            type: number
      outType:
        type: stream
        stream:
          type: generic
          generic: itemType
      selectType:
        type: boolean
  takeNth:
    operator: slang.stream.takeNth
    properties:
      default: null
    generics:
      itemType:
        type: generic
        generic: itemType
connections:
  (:
  - (length
  - item.items(switch
  const):
  - (switch.false
  eval):
  - index(loop
  eval1):
  - ~.state.index(loop.iteration
  - x(eval2
  eval2):
  - ~.continue(loop.iteration
  eval3):
  - select(switch
  length):
  - x(eval3
  - item.length(switch
  loop.iteration)~.index:
  - triggers.~(repeat
  - index(takeNth
  - x(eval1
  repeat)~:
  - items(takeNth
  switch):
  - )
  switch.false)length:
  - (const
  switch.true)items:
  - value(repeat
  switch.true)length:
  - x(eval
  takeNth)item:
  - ~(switch.true
