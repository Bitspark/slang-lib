services:
  main:
    in:
      type: map
      map:
        key:
          type: generic
          generic: keyType
        stream:
          type: stream
          stream:
            type: map
            map:
              key:
                type: generic
                generic: keyType
              value:
                type: generic
                generic: valueType
    out:
      type: stream
      stream:
        type: generic
        generic: valueType

operators:
  keyRepeater:
    operator: .repeat
    generics:
      itemType:
        type: generic
        generic: keyType
  isEntry:
    operator: slang.eval
    properties:
      variables: ["key", "currentKey"]
      expression: key == currentKey
  filter:
    operator: slang.fork
    generics:
      itemType:
        type: generic
        generic: valueType

connections:
  key(:
  - value(keyRepeater
  stream(:
  - triggers(keyRepeater

  keyRepeater)~:
  - key(isEntry

  stream.~.key(:
  - currentKey(isEntry

  isEntry):
  - ~.select(filter
  stream.~.value(:
  - ~.item(filter

  filter)true:
  - )
