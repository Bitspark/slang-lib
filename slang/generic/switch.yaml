services:
  main:
    in:
      type: stream
      stream:
        type: map
        map:
          select:
            type: generic
            generic: selectType
          item:
            type: generic
            generic: inItemType
    out:
      type: stream
      stream:
        type: generic
        generic: outItemType
delegates:
  handler:
    out:
      type: stream
      stream:
        type: generic
        generic: inItemType
    in:
      type: stream
      stream:
        type: generic
        generic: outItemType
  default:
    out:
      type: stream
      stream:
        type: map
        map:
          select:
            type: generic
            generic: selectType
          item:
            type: generic
            generic: inItemType
    in:
      type: stream
      stream:
        type: generic
        generic: outItemType
properties:
- value

operators:
  checker:
    operator: .equals
    generics:
      itemType:
        type: generic
        generic: selectType
    properties:
      value: $value
  fork:
    operator: slang.fork
    generics:
      itemType:
        type: map
        map:
          select:
            type: generic
            generic: selectType
          item:
            type: generic
            generic: inItemType
  merge:
    operator: slang.merge
    generics:
      itemType:
        type: generic
        generic: outItemType

connections:
  ~.select(:
  - (checker
  - ~.item.select(fork
  checker):
  - ~.select(fork
  - select.~(merge
  ~.item(:
  - ~.item.item(fork

  fork)true.~.item:
  - .handler)~
  ~(.handler:
  - true.~(merge

  fork)false.~:
  - .default)~
  ~(.default:
  - false.~(merge

  merge)~:
  - )~