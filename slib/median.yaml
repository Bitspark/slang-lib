# Median: calculates median value
---
in:
  type: stream
  stream:
    type: number
out:
  type: number

operators:
  # Sort the stream
  sorter:
    operator: .merge_sort
  # Get length of stream
  length:
    operator: .length_reduce
    generics:
      itemType:
        type: number
  # Calculate middle index
  halve:
    operator: eval
    generics:
      paramsMap:
        type: map
        map:
          x:
            type: number
    properties:
      expression: floor(x/2)
  # Take middle value from sorted stream
  takenth:
    operator: .take_nth
    properties:
      default: null

connections:
  (:
  - (sorter
  - (length
  length):
  - x(halve
  sorter):
  - items(takenth
  halve):
  - index(takenth
  takenth):
  - )
